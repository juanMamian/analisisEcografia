(function(i){function e(e){for(var s,t,r=e[0],l=e[1],c=e[2],d=0,h=[];d<r.length;d++)t=r[d],Object.prototype.hasOwnProperty.call(a,t)&&a[t]&&h.push(a[t][0]),a[t]=0;for(s in l)Object.prototype.hasOwnProperty.call(l,s)&&(i[s]=l[s]);u&&u(e);while(h.length)h.shift()();return o.push.apply(o,c||[]),n()}function n(){for(var i,e=0;e<o.length;e++){for(var n=o[e],s=!0,r=1;r<n.length;r++){var l=n[r];0!==a[l]&&(s=!1)}s&&(o.splice(e--,1),i=t(t.s=n[0]))}return i}var s={},a={app:0},o=[];function t(e){if(s[e])return s[e].exports;var n=s[e]={i:e,l:!1,exports:{}};return i[e].call(n.exports,n,n.exports,t),n.l=!0,n.exports}t.m=i,t.c=s,t.d=function(i,e,n){t.o(i,e)||Object.defineProperty(i,e,{enumerable:!0,get:n})},t.r=function(i){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},t.t=function(i,e){if(1&e&&(i=t(i)),8&e)return i;if(4&e&&"object"===typeof i&&i&&i.__esModule)return i;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:i}),2&e&&"string"!=typeof i)for(var s in i)t.d(n,s,function(e){return i[e]}.bind(null,s));return n},t.n=function(i){var e=i&&i.__esModule?function(){return i["default"]}:function(){return i};return t.d(e,"a",e),e},t.o=function(i,e){return Object.prototype.hasOwnProperty.call(i,e)},t.p="/analisisDoppler/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],l=r.push.bind(r);r.push=e,r=r.slice();for(var c=0;c<r.length;c++)e(r[c]);var u=l;o.push([0,"chunk-vendors"]),n()})({0:function(i,e,n){i.exports=n("56d7")},"034f":function(i,e,n){"use strict";n("85ec")},"56d7":function(i,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var s=n("2b0e"),a=function(){var i=this,e=i.$createElement,s=i._self._c||e;return s("div",{attrs:{id:"app"}},[s("div",{attrs:{id:"zonaSelectImagen"}},[s("img",{attrs:{src:n("cf55"),alt:"Cargar imágen",id:"botonUploadEco"},on:{click:function(e){return i.$refs.inputEcografia.click()}}}),s("input",{ref:"inputEcografia",staticStyle:{visibility:"hidden"},attrs:{type:"file",name:"inputEcografia",id:"inputEcografia"},on:{change:i.mostrarImagenSeleccionada}}),s("center",[s("div",{directives:[{name:"show",rawName:"v-show",value:i.imagenSelected,expression:"imagenSelected"}],attrs:{id:"zonaImagenSeleccionada"},on:{click:function(e){return e.ctrlKey?i.iniciarDibujoZonaAnalisis(e):null},mousemove:i.resizeZonaAnalisis,keyup:function(e){return!e.type.indexOf("key")&&i._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:i.setZonaAnalisis(e)}}},[s("canvas",{directives:[{name:"show",rawName:"v-show",value:i.showContornoEco,expression:"showContornoEco"}],ref:"canvasContorno",attrs:{id:"canvasContorno"}}),s("img",{ref:"imagenSeleccionada",attrs:{draggable:"false",src:"",alt:"Ninguna imágen seleccionada",id:"imagenSeleccionada"}}),s("div",{style:[i.offsetZonaAnalisis],attrs:{id:"zonaAnalisis"}},[s("div",{directives:[{name:"show",rawName:"v-show",value:i.respuestaRecibida,expression:"respuestaRecibida"}],attrs:{id:"controlesZonaAnalisis"}},[s("div",{staticClass:"bloqueControl"},[s("label",{staticClass:"labelCheckbox",attrs:{for:"showContornoEco"}},[i._v("Contorno")]),s("input",{directives:[{name:"model",rawName:"v-model",value:i.showContornoEco,expression:"showContornoEco"}],staticClass:"checkControlAnalisis",attrs:{type:"checkbox",name:"showContornoEco",id:"showContornoEco"},domProps:{checked:Array.isArray(i.showContornoEco)?i._i(i.showContornoEco,null)>-1:i.showContornoEco},on:{change:function(e){var n=i.showContornoEco,s=e.target,a=!!s.checked;if(Array.isArray(n)){var o=null,t=i._i(n,o);s.checked?t<0&&(i.showContornoEco=n.concat([o])):t>-1&&(i.showContornoEco=n.slice(0,t).concat(n.slice(t+1)))}else i.showContornoEco=a}}})]),s("div",{staticClass:"bloqueControl"},[s("label",{staticClass:"labelCheckbox",attrs:{for:"showMarcasR"}},[i._v("R")]),s("input",{directives:[{name:"model",rawName:"v-model",value:i.showMarcasR,expression:"showMarcasR"}],staticClass:"checkControlAnalisis",attrs:{type:"checkbox",name:"showMarcasR",id:"showMarcasR"},domProps:{checked:Array.isArray(i.showMarcasR)?i._i(i.showMarcasR,null)>-1:i.showMarcasR},on:{change:function(e){var n=i.showMarcasR,s=e.target,a=!!s.checked;if(Array.isArray(n)){var o=null,t=i._i(n,o);s.checked?t<0&&(i.showMarcasR=n.concat([o])):t>-1&&(i.showMarcasR=n.slice(0,t).concat(n.slice(t+1)))}else i.showMarcasR=a}}})]),i.variabilidad?s("div",{staticClass:"infoAnalisis",attrs:{id:"infoVariabilidad"}},[i._v(" Variación promedio: "+i._s(i.variabilidad.toFixed(2))+" "),s("br"),i._v(" Ajustada: "+i._s(i.variabilidadAjustada.toFixed(2))+" ")]):i._e(),i.margenError?s("div",{staticClass:"infoAnalisis",attrs:{id:"infoMargenError"}},[i._v(" Margen de error: "+i._s(i.margenError.toFixed(2))+"ms ")]):i._e()]),i._l(i.quiebres,(function(e,n){return s("div",{directives:[{name:"show",rawName:"v-show",value:i.showMarcasR,expression:"showMarcasR"}],key:"quiebre"+n,staticClass:"marcaQuiebre",style:[{left:e.left-1+"px"}]},[s("div",{staticClass:"controlesQuiebre"}),null!=e.intervalo?s("div",{staticClass:"infoQuiebre infoIntervalo"},[i._v(i._s(e.intervalo.toFixed(2))+"ms")]):i._e(),null!=e.intervalo?s("div",{staticClass:"infoQuiebre infoIntervaloAjustado"},[i._v(i._s(e.intervaloAjustado.toFixed(2))+"ms")]):i._e()])})),s("div",{attrs:{id:"lineaMarcasTiempo"}}),s("div",{staticClass:"agarraderoZonaAnalisis",attrs:{id:"agarraderoZonaAnalisis1"},on:{mousedown:function(e){return!e.type.indexOf("key")&&i._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:i.iniciarResize(0)},mousemove:function(e){return i.resizeZonaAnalisis(0,e)},mouseup:function(e){return!e.type.indexOf("key")&&i._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:i.endResize(0)}}},[s("div",{directives:[{name:"show",rawName:"v-show",value:1==i.resizingZonaAnalisis[0],expression:"resizingZonaAnalisis[0] == true"}],staticClass:"burbujaHover"})]),s("div",{staticClass:"agarraderoZonaAnalisis",attrs:{id:"agarraderoZonaAnalisis2"},on:{mousedown:function(e){return!e.type.indexOf("key")&&i._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:i.iniciarResize(1)},mousemove:function(e){return i.resizeZonaAnalisis(1,e)},mouseup:function(e){return!e.type.indexOf("key")&&i._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:i.endResize(1)}}},[s("div",{directives:[{name:"show",rawName:"v-show",value:1==i.resizingZonaAnalisis[1],expression:"resizingZonaAnalisis[1] == true"}],staticClass:"burbujaHover"})]),s("div",{staticClass:"agarraderoZonaAnalisis",attrs:{id:"agarraderoZonaAnalisis3"},on:{mousedown:function(e){return!e.type.indexOf("key")&&i._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:i.iniciarResize(2)},mousemove:function(e){return i.resizeZonaAnalisis(2,e)},mouseup:function(e){return!e.type.indexOf("key")&&i._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:i.endResize(2)}}},[s("div",{directives:[{name:"show",rawName:"v-show",value:1==i.resizingZonaAnalisis[2],expression:"resizingZonaAnalisis[2] == true"}],staticClass:"burbujaHover"})]),s("div",{staticClass:"agarraderoZonaAnalisis",attrs:{id:"agarraderoZonaAnalisis4"},on:{mousedown:function(e){return!e.type.indexOf("key")&&i._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:i.iniciarResize(3)},mousemove:function(e){return i.resizeZonaAnalisis(3,e)},mouseup:function(e){return!e.type.indexOf("key")&&i._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:i.endResize(3)}}},[s("div",{directives:[{name:"show",rawName:"v-show",value:1==i.resizingZonaAnalisis[3],expression:"resizingZonaAnalisis[3] == true"}],staticClass:"burbujaHover"})])],2)]),s("br"),s("br"),s("button",{directives:[{name:"show",rawName:"v-show",value:i.imagenSelected,expression:"imagenSelected"}],ref:"botonEnviarEco",attrs:{id:"botonEnviarEco"},on:{click:i.uploadEcografia}},[i._v("Aceptar")])])],1),i._m(0)])},o=[function(){var i=this,e=i.$createElement,n=i._self._c||e;return n("div",{attrs:{id:"tablaResultados"}},[n("div",{staticClass:"cosa"}),n("div",{staticClass:"valor"})])}],t=(n("cb29"),n("a434"),n("d81d"),n("4de4"),n("bc3a")),r=n.n(t),l={name:"App",data:function(){return{montado:!1,enviandoEco:!1,respuestaAnalisis:null,respuestaRecibida:!1,urlImagenRespuesta:null,quiebres:[],margenError:null,sizeImagenSeleccionada:{x:null,y:null},imagenSelected:!1,posicionesZonaAnalisis:{x1:0,y1:0,x2:0,y2:0},umbralSize:30,resizingZonaAnalisis:[!1,!1,!1,!1],showContornoEco:!0,showMarcasR:!0}},methods:{setZonaAnalisis:function(){this.resizingZonaAnalisis=!1},vaciarAnalisis:function(){this.quiebres=[];var i=this.$refs.canvasContorno,e=i.getContext("2d");e.clearRect(0,0,i.width,i.height)},iniciarResize:function(i){this.vaciarAnalisis(),this.resizingZonaAnalisis.fill(!1),this.resizingZonaAnalisis.splice(i,1,!0)},endResize:function(){this.resizingZonaAnalisis.splice(0,1,!1),this.resizingZonaAnalisis.splice(1,1,!1),this.resizingZonaAnalisis.splice(2,1,!1),this.resizingZonaAnalisis.splice(3,1,!1)},resizeZonaAnalisis:function(i,e){if(this.resizingZonaAnalisis[i]){var n=document.getElementById("zonaImagenSeleccionada").getBoundingClientRect(),s={x:e.clientX-n.left,y:e.clientY-n.top},a="x",o="y";0==i?(a="x1",o="y1"):1==i?(a="x2",o="y1"):2==i?(a="x1",o="y2"):3==i&&(a="x2",o="y2"),this.$set(this.posicionesZonaAnalisis,a,s.x),this.$set(this.posicionesZonaAnalisis,o,s.y),this.posicionesZonaAnalisis.x1<0&&this.$set(this.posicionesZonaAnalisis,"x1",0),this.posicionesZonaAnalisis.x2<this.umbralSize&&this.$set(this.posicionesZonaAnalisis,"x2",this.umbralSize),this.posicionesZonaAnalisis.y1<0&&this.$set(this.posicionesZonaAnalisis,"y1",0),this.posicionesZonaAnalisis.y2<this.umbralSize&&this.$set(this.posicionesZonaAnalisis,"y2",this.umbralSize),this.posicionesZonaAnalisis.x2>n.width&&this.$set(this.posicionesZonaAnalisis,"x2",n.width),this.posicionesZonaAnalisis.y2>n.height&&this.$set(this.posicionesZonaAnalisis,"y2",n.height),this.posicionesZonaAnalisis.x1>this.posicionesZonaAnalisis.x2-this.umbralSize&&this.$set(this.posicionesZonaAnalisis,"x1",this.posicionesZonaAnalisis.x2-this.umbralSize),this.posicionesZonaAnalisis.y1>this.posicionesZonaAnalisis.y2-this.umbralSize&&this.$set(this.posicionesZonaAnalisis,"y1",this.posicionesZonaAnalisis.y2-this.umbralSize)}},mostrarImagenSeleccionada:function(){var i=this.$refs.inputEcografia.files[0],e=this;if(this.imagenSelected=!0,FileReader&&i){this.vaciarAnalisis();var n=new FileReader;n.onload=function(){e.$refs.imagenSeleccionada.src=n.result,e.$nextTick((function(){var i=e.$refs.imagenSeleccionada.offsetWidth,n=e.$refs.imagenSeleccionada.offsetHeight;e.$set(e.sizeImagenSeleccionada,"x",i),e.$set(e.sizeImagenSeleccionada,"y",n),e.posicionesZonaAnalisis.x2-e.posicionesZonaAnalisis.x1!=0&&e.posicionesZonaAnalisis.y2-e.posicionesZonaAnalisis.y1!=0||(e.posicionesZonaAnalisis={x1:0,y1:0,x2:i,y2:n}),e.$set(e.posicionesZonaAnalisis,"y2",n)}))},n.readAsDataURL(i)}},uploadEcografia:function(){var i=document.getElementById("inputEcografia"),e=new FormData,n=i.files[0];e.append("ecografia",n),e.append("posicionesZonaAnalisis",JSON.stringify(this.posicionesZonaAnalisis)),this.enviandoEco=!0;var s=this;r()({method:"post",url:this.serverUrl+"/ecografias/analizarImagen",data:e,headers:{"Content-Type":"multipart/form-data"}}).then((function(i){var e=i.data;s.respuestaRecibida=!0,s.enviandoEco=!1,s.trazarContornoEco(e.linea),s.marcarTiempos(e.marcasTiempo),s.quiebres=e.puntosQuiebre,s.margenError=e.margenError})).catch((function(i){s.enviandoEco=!1,console.log("Error analizando la ecografía. E: ".concat(i))}))},trazarContornoEco:function(i){var e=document.getElementById("zonaAnalisis"),n=document.getElementById("canvasContorno");n.style.left=e.style.left,n.style.top=e.style.top,n.style.width=e.style.width,n.style.height=e.style.height,n.width=parseInt(e.style.width),n.height=parseInt(e.style.height);var s=n.getContext("2d");s.fillStyle="red";for(var a=0;a<parseInt(e.style.width);a++)s.fillRect(a,i[a],1,1)},marcarTiempos:function(i){var e=document.getElementById("zonaAnalisis").getBoundingClientRect(),n=document.getElementById("canvasContorno"),s=n.getContext("2d");s.fillStyle="yellow";for(var a=0;a<i.length;a++)s.fillRect(i[a],e.height-10,1,7)},marcarQuiebres:function(i){console.log("Trazando quiebres: ".concat(i));var e=document.getElementById("zonaAnalisis").getBoundingClientRect(),n=document.getElementById("canvasContorno"),s=n.getContext("2d");s.fillStyle="green";for(var a=0;a<i.length;a++)s.fillRect(i[a],0,1,e.height)},teclaPresionada:function(i){13===i.which&&this.imagenSelected&&this.$refs.botonEnviarEco.click(),78===i.which&&this.$refs.inputEcografia.click(),82===i.which&&document.getElementById("showMarcasR").click(),67===i.which&&document.getElementById("showContornoEco").click()}},computed:{offsetZonaAnalisis:function(){if(this.montado)return{left:this.posicionesZonaAnalisis.x1+"px",top:this.posicionesZonaAnalisis.y1+"px",width:this.posicionesZonaAnalisis.x2-this.posicionesZonaAnalisis.x1+"px",height:this.posicionesZonaAnalisis.y2-this.posicionesZonaAnalisis.y1+"px"}},variabilidad:function(){var i=this.quiebres.filter((function(i){return i.variacion})).map((function(i){return i.variacion}));return i.length<1?null:i.reduce((function(i,e){return Math.abs(i)+Math.abs(e)}),0)/i.length},variabilidadAjustada:function(){var i=this.quiebres.filter((function(i){return i.variacionAjustada})).map((function(i){return i.variacionAjustada}));return i.length<1?null:i.reduce((function(i,e){return Math.abs(i)+Math.abs(e)}),0)/i.length}},mounted:function(){this.montado=!0,document.addEventListener("keyup",this.teclaPresionada)}},c=l,u=(n("034f"),n("2877")),d=Object(u["a"])(c,a,o,!1,null,null,null),h=d.exports;s["a"].config.productionTip=!1;var f=window.location.href.substring(7,16),p="localhost"!=f?"https://analisisdoppler.herokuapp.com":"http://localhost:3000";s["a"].mixin({data:function(){return{serverUrl:p}}}),new s["a"]({render:function(i){return i(h)}}).$mount("#app")},"85ec":function(i,e,n){},cf55:function(i,e,n){i.exports=n.p+"img/upload.437c244f.png"}});
//# sourceMappingURL=app.17b0a954.js.map